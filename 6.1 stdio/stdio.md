# stdio

システムコールを直接使用すると、プログラム全体の処理速度が遅くなってしまうという問題があります。

そこで`stdio`というライブラリを使用します。

## バッファリング

`stdio`は、独自のバッファ（データの保存場所）を持っています。

このバッファを通じてデータをやりとりすることを「バッファリング」といいます。

バッファリングを使用することで、データをまとめて読み込むことができ、結果的にいちいちシステムコールを呼び出すよりも高速に処理ができます。

書き込み時も同様にバッファを使用します。

一定量のデータをバッファにまとめておき、バッファがいっぱいになったらまとめて書き込みを実行するのです。

こうすることで書き込み処理を高速に行うことができます。

## バッファを使わない場合

以下の場合はバッファを使いません。

1. ストリームの向こうに端末がある場合
2. アンバッファモードの場合
3. 標準エラー出力に出力する場合

### 1. ストリームの向こうに端末がある場合

ストリームの向こうに端末がある場合は、バッファを使いません。

なぜなら、ストリームの向こうに端末がある場合、**人間が処理を待っているため**です。

つまり、即座に出力をした方が人間にとっては応答が早く、便利だということです。

### 2. アンバッファモードの場合

`setvbuf()`を使用することで、バッファを使わない「アンバッファモード」で処理を行うことができます。

### 3. 標準エラー出力に出力する場合

標準エラー出力に出力する場合もバッファは使いません。

なぜなら、その方が人間にとって使いやすいためです。

標準エラー出力はデバッグ出力などに使うため、速度よりもすぐに出力された方が便利というわけです。

## fopen, fclose

`fopen()`はファイルのストリームを作り、`fclose()`はストリームを閉じます。
